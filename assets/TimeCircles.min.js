(function(e){var t,s,o,a,r,c,l,d,u,n=window;Object.keys||(Object.keys=function(){"use strict";var t=Object.prototype.hasOwnProperty,n=!{toString:null}.propertyIsEnumerable("toString"),e=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],s=e.length;return function(o){if(typeof o!="object"&&(typeof o!="function"||o===null))throw new TypeError("Object.keys called on non-object");var i,r,a=[];for(r in o)t.call(o,r)&&a.push(r);if(n)for(i=0;i<s;i++)t.call(o,e[i])&&a.push(e[i]);return a}}()),r=!1,c=200,d=location.hash==="#debug";function j(e){d&&console.log(e)}l=["Days","Hours","Minutes","Seconds"],u={Seconds:"Minutes",Minutes:"Hours",Hours:"Days",Days:"Years"},o={Seconds:1,Minutes:60,Hours:3600,Days:86400,Months:2678400,Years:31536e3};function b(e){var t,s,n=/^rgba?\(([\d]+),([\d]+),([\d]+)(,([\d.]+))?\)$/;return n.test(e)?(t=n.exec(e),{r:parseInt(t[1]),g:parseInt(t[2]),b:parseInt(t[3]),a:parseInt(t[5]?t[5]:1)}):(s=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,e=e.replace(s,function(e,t,n,s){return t+t+n+n+s+s}),t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null)}function p(){var e=document.createElement("canvas");return!!(e.getContext&&e.getContext("2d"))}function i(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function f(){return i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i()}Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var n=this.length>>>0,t=Number(arguments[1])||0,t=t<0?Math.ceil(t):Math.floor(t);for(t<0&&(t+=n);t<n;t++)if(t in this&&this[t]===e)return t;return-1});function m(e){var t,n,s,o,i=e.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}\s[0-9]{1,2}:[0-9]{2}:[0-9]{2}$/);return i!==null&&i.length>0?(o=e.split(" "),n=o[0].split("-"),s=o[1].split(":"),new Date(n[0],n[1]-1,n[2],s[0],s[1],s[2])):(t=Date.parse(e),isNaN(t)?(t=Date.parse(e.replace(/-/g,"/").replace("T"," ")),isNaN(t)?new Date:t):t)}function h(e,t,n,s,i){for(var a,r,c,l,h={},m={},f={},p={},g={},v={},d=null,u=0;u<s.length;u++)a=s[u],d===null?l=n/o[a]:l=o[d]/o[a],r=e/o[a],c=t/o[a],i&&(r>0?r=Math.floor(r):r=Math.ceil(r),c>0?c=Math.floor(c):c=Math.ceil(c)),a!=="Days"&&(r=r%l,c=c%l),h[a]=r,f[a]=Math.abs(r),m[a]=c,v[a]=Math.abs(c),p[a]=Math.abs(r)/l,g[a]=Math.abs(c)/l,d=a;return{raw_time:h,raw_old_time:m,time:f,old_time:v,pct:p,old_pct:g}}a={};function g(){typeof n.TC_Instance_List!="undefined"?a=n.TC_Instance_List:n.TC_Instance_List=a,v(n)}function v(e){for(var n=["webkit","moz"],t=0;t<n.length&&!e.requestAnimationFrame;++t)e.requestAnimationFrame=e[n[t]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[n[t]+"CancelAnimationFrame"];(!e.requestAnimationFrame||!e.cancelAnimationFrame)&&(e.requestAnimationFrame=function(t,n,s){typeof s=="undefined"&&(s={data:{last_frame:0}});var o=(new Date).getTime(),i=Math.max(0,16-(o-s.data.last_frame)),a=e.setTimeout(function(){t(o+i)},i);return s.data.last_frame=o+i,a},e.cancelAnimationFrame=function(e){clearTimeout(e)})}t=function(e,t){this.element=e,this.container,this.listeners=null,this.data={paused:!1,last_frame:0,animation_frame:null,interval_fallback:null,timer:!1,total_duration:null,prev_time:null,drawn_units:[],text_elements:{Days:null,Hours:null,Minutes:null,Seconds:null},attributes:{canvas:null,context:null,item_size:null,line_width:null,radius:null,outer_radius:null},state:{fading:{Days:!1,Hours:!1,Minutes:!1,Seconds:!1}}},this.config=null,this.setOptions(t),this.initialize()},t.prototype.clearListeners=function(){this.listeners={all:[],visible:[]}},t.prototype.addTime=function(e){if(this.data.attributes.ref_date instanceof Date){var t=this.data.attributes.ref_date;t.setSeconds(t.getSeconds()+e)}else isNaN(this.data.attributes.ref_date)||(this.data.attributes.ref_date+=e*1e3)},t.prototype.initialize=function(t){this.data.drawn_units=[];for(var s,o,i,a,l,d,u,h,m,f,c=0;c<Object.keys(this.config.time).length;c++)m=Object.keys(this.config.time)[c],this.config.time[m].show&&this.data.drawn_units.push(m);e(this.element).children("div.time_circles").remove(),typeof t=="undefined"&&(t=!0),(t||this.listeners===null)&&this.clearListeners(),this.container=e("<div>"),this.container.addClass("time_circles"),this.container.appendTo(this.element),s=this.element.offsetHeight,o=this.element.offsetWidth,s===0&&(s=e(this.element).height()),o===0&&(o=e(this.element).width()),s===0&&o>0?s=o/this.data.drawn_units.length:o===0&&s>0&&(o=s*this.data.drawn_units.length),a=document.createElement("canvas"),a.width=o,a.height=s,this.data.attributes.canvas=e(a),this.data.attributes.canvas.appendTo(this.container),l=p(),!l&&typeof G_vmlCanvasManager!="undefined"&&(G_vmlCanvasManager.initElement(a),r=!0,l=!0),l&&(this.data.attributes.context=a.getContext("2d")),this.data.attributes.item_size=Math.min(o/this.data.drawn_units.length,s),this.data.attributes.line_width=this.data.attributes.item_size*this.config.fg_width,this.data.attributes.radius=(this.data.attributes.item_size*.8-this.data.attributes.line_width)/2,this.data.attributes.outer_radius=this.data.attributes.radius+.5*Math.max(this.data.attributes.line_width,this.data.attributes.line_width*this.config.bg_width),c=0;for(d in this.data.text_elements){if(!this.config.time[d].show)continue;i=e("<div>"),i.addClass("textDiv_"+d),i.css("top",Math.round(.35*this.data.attributes.item_size)),i.css("left",Math.round(c++*this.data.attributes.item_size)),i.css("width",this.data.attributes.item_size),i.appendTo(this.container),u=e("<h4>"),u.text(this.config.time[d].text),u.css("font-size",Math.round(this.config.text_size*this.data.attributes.item_size)),u.appendTo(i),h=e("<span>"),h.css("font-size",Math.round(this.config.number_size*this.data.attributes.item_size)),h.appendTo(i),this.data.text_elements[d]=h}this.start(),this.config.start||(this.data.paused=!0),f=this,this.data.interval_fallback=n.setInterval(function(){f.update.call(f,!0)},100)},t.prototype.update=function(e){if(typeof e=="undefined")e=!1;else if(e&&this.data.paused)return;r&&this.data.attributes.context.clearRect(0,0,this.data.attributes.canvas[0].width,this.data.attributes.canvas[0].hright);var t,s,i,a,d,u,m,f,p,g,v,j,_,w,O,x,y=this.data.prev_time,b=new Date;if(this.data.prev_time=b,y===null&&(y=b),!this.config.count_past_zero&&b>this.data.attributes.ref_date){for(a=0;a<this.data.drawn_units.length;a++)t=this.data.drawn_units[a],this.data.text_elements[t].text("0"),m=a*this.data.attributes.item_size+this.data.attributes.item_size/2,f=this.data.attributes.item_size/2,d=this.config.time[t].color,this.drawArc(m,f,d,0);this.stop();return}p=(this.data.attributes.ref_date-b)/1e3,_=(this.data.attributes.ref_date-y)/1e3,O=this.config.animation!=="smooth",s=h(p,_,this.data.total_duration,this.data.drawn_units,O),v=h(p,_,o.Years,l,O),a=0,j=0,u=null,x=this.data.drawn_units.slice();for(a in l){if(t=l[a],Math.floor(v.raw_time[t])!==Math.floor(v.raw_old_time[t])&&this.notifyListeners(t,Math.floor(v.time[t]),Math.floor(p),"all"),x.indexOf(t)<0)continue;Math.floor(s.raw_time[t])!==Math.floor(s.raw_old_time[t])&&this.notifyListeners(t,Math.floor(s.time[t]),Math.floor(p),"visible"),e||(this.data.text_elements[t].text(Math.floor(Math.abs(s.time[t]))),m=j*this.data.attributes.item_size+this.data.attributes.item_size/2,f=this.data.attributes.item_size/2,d=this.config.time[t].color,this.config.animation==="smooth"?(u!==null&&!r&&(Math.floor(s.time[u])>Math.floor(s.old_time[u])?(this.radialFade(m,f,d,1,t),this.data.state.fading[t]=!0):Math.floor(s.time[u])<Math.floor(s.old_time[u])&&(this.radialFade(m,f,d,0,t),this.data.state.fading[t]=!0)),this.data.state.fading[t]||this.drawArc(m,f,d,s.pct[t])):this.animateArc(m,f,d,s.pct[t],s.old_pct[t],(new Date).getTime()+c)),u=t,j++}if(this.data.paused||e)return;i=this,w=function(){i.update.call(i)},this.config.animation==="smooth"?this.data.animation_frame=n.requestAnimationFrame(w,i.element,i):(g=p%1*1e3,g<0&&(g=1e3+g),g+=50,i.data.animation_frame=n.setTimeout(function(){i.data.animation_frame=n.requestAnimationFrame(w,i.element,i)},g))},t.prototype.animateArc=function(e,t,s,o,i,a){if(this.data.attributes.context===null)return;var r,l,d,u=i-o;if(Math.abs(u)>.5)o===0?this.radialFade(e,t,s,1):this.radialFade(e,t,s,0);else{if(r=(c-(a-(new Date).getTime()))/c,r>1&&(r=1),l=i*(1-r)+o*r,this.drawArc(e,t,s,l),r>=1)return;d=this,n.requestAnimationFrame(function(){d.animateArc(e,t,s,o,i,a)},this.element)}},t.prototype.drawArc=function(e,t,n,s){if(this.data.attributes.context===null)return;var o,i,c,l,d,u,a=Math.max(this.data.attributes.outer_radius,this.data.attributes.item_size/2);r||this.data.attributes.context.clearRect(e-a,t-a,a*2,a*2),this.config.use_background&&(this.data.attributes.context.beginPath(),this.data.attributes.context.arc(e,t,this.data.attributes.radius,0,2*Math.PI,!1),this.data.attributes.context.lineWidth=this.data.attributes.line_width*this.config.bg_width,this.data.attributes.context.strokeStyle=this.config.circle_bg_color,this.data.attributes.context.stroke()),d=-.5*Math.PI,u=2*Math.PI,o=d+this.config.start_angle/360*u,i=2*s*Math.PI,this.config.direction==="Both"?(l=!1,o-=i/2,c=o+i):this.config.direction==="Clockwise"?(l=!1,c=o+i):(l=!0,c=o-i),this.data.attributes.context.beginPath(),this.data.attributes.context.arc(e,t,this.data.attributes.radius,o,c,l),this.data.attributes.context.lineWidth=this.data.attributes.line_width,this.data.attributes.context.strokeStyle=n,this.data.attributes.context.stroke()},t.prototype.radialFade=function(e,t,s,o,i){var a,r=b(s),c=this,l=.2*(o===1?-1:1);for(a=0;o<=1&&o>=0;a++)(function(){var s=50*a,i="rgba("+r.r+", "+r.g+", "+r.b+", "+Math.round(o*10)/10+")";n.setTimeout(function(){c.drawArc(e,t,i,1)},s)})(),o+=l;typeof i!==void 0&&n.setTimeout(function(){c.data.state.fading[i]=!1},50*a)},t.prototype.timeLeft=function(){if(this.data.paused&&typeof this.data.timer=="number")return this.data.timer;var e=new Date;return(this.data.attributes.ref_date-e)/1e3},t.prototype.start=function(){n.cancelAnimationFrame(this.data.animation_frame),n.clearTimeout(this.data.animation_frame);var t,s=e(this.element).data("date");typeof s=="undefined"&&(s=e(this.element).attr("data-date")),typeof s=="string"?this.data.attributes.ref_date=m(s):typeof this.data.timer=="number"?this.data.paused&&(this.data.attributes.ref_date=(new Date).getTime()+this.data.timer*1e3):(t=e(this.element).data("timer"),typeof t=="undefined"&&(t=e(this.element).attr("data-timer")),typeof t=="string"&&(t=parseFloat(t)),typeof t=="number"?(this.data.timer=t,this.data.attributes.ref_date=(new Date).getTime()+t*1e3):this.data.attributes.ref_date=this.config.ref_date),this.data.paused=!1,this.update.call(this)},t.prototype.restart=function(){this.data.timer=!1,this.start()},t.prototype.stop=function(){typeof this.data.timer=="number"&&(this.data.timer=this.timeLeft(this)),this.data.paused=!0,n.cancelAnimationFrame(this.data.animation_frame)},t.prototype.destroy=function(){this.clearListeners(),this.stop(),n.clearInterval(this.data.interval_fallback),this.data.interval_fallback=null,this.container.remove(),e(this.element).removeAttr("data-tc-id"),e(this.element).removeData("tc-id")},t.prototype.setOptions=function(t){if(this.config===null&&(this.default_options.ref_date=new Date,this.config=e.extend(!0,{},this.default_options)),e.extend(!0,this.config,t),this.config.use_top_frame?n=window.top:n=window,g(),this.data.total_duration=this.config.total_duration,typeof this.data.total_duration=="string")if(typeof o[this.data.total_duration]!="undefined")this.data.total_duration=o[this.data.total_duration];else if(this.data.total_duration==="Auto"){for(var i,s=0;s<Object.keys(this.config.time).length;s++)if(i=Object.keys(this.config.time)[s],this.config.time[i].show){this.data.total_duration=o[u[i]];break}}else this.data.total_duration=o.Years,console.error("Valid values for TimeCircles config.total_duration are either numeric, or (string) Years, Months, Days, Hours, Minutes, Auto")},t.prototype.addListener=function(e,t,n){if(typeof e!="function")return;typeof n=="undefined"&&(n="visible"),this.listeners[n].push({func:e,scope:t})},t.prototype.notifyListeners=function(e,t,n,s){for(var i,o=0;o<this.listeners[s].length;o++)i=this.listeners[s][o],i.func.apply(i.scope,[e,t,n])},t.prototype.default_options={ref_date:new Date,start:!0,animation:"smooth",count_past_zero:!0,circle_bg_color:"#60686F",use_background:!0,fg_width:.1,bg_width:1.2,text_size:.07,number_size:.28,total_duration:"Auto",direction:"Clockwise",use_top_frame:!1,start_angle:0,time:{Days:{show:!0,text:"Days",color:"#FC6"},Hours:{show:!0,text:"Hours",color:"#9CF"},Minutes:{show:!0,text:"Minutes",color:"#BFB"},Seconds:{show:!0,text:"Seconds",color:"#F99"}}},s=function(e,t){this.elements=e,this.options=t,this.foreach()},s.prototype.getInstance=function(n){var o,i,r,s=e(n).data("tc-id");return typeof s=="undefined"&&(s=f(),e(n).attr("data-tc-id",s)),typeof a[s]=="undefined"?(r=this.options,o=e(n).data("options"),typeof o=="string"&&(o=JSON.parse(o)),typeof o=="object"&&(r=e.extend(!0,{},this.options,o)),i=new t(n,r),a[s]=i):(i=a[s],typeof this.options!="undefined"&&i.setOptions(this.options)),i},s.prototype.addTime=function(e){this.foreach(function(t){t.addTime(e)})},s.prototype.foreach=function(e){var t=this;return this.elements.each(function(){var n=t.getInstance(this);typeof e=="function"&&e(n)}),this},s.prototype.start=function(){return this.foreach(function(e){e.start()}),this},s.prototype.stop=function(){return this.foreach(function(e){e.stop()}),this},s.prototype.restart=function(){return this.foreach(function(e){e.restart()}),this},s.prototype.rebuild=function(){return this.foreach(function(e){e.initialize(!1)}),this},s.prototype.getTime=function(){return this.getInstance(this.elements[0]).timeLeft()},s.prototype.addListener=function(e,t){typeof t=="undefined"&&(t="visible");var n=this;return this.foreach(function(s){s.addListener(e,n.elements,t)}),this},s.prototype.destroy=function(){return this.foreach(function(e){e.destroy()}),this},s.prototype.end=function(){return this.elements},e.fn.TimeCircles=function(e){return new s(this,e)}})(jQuery)